<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="digbyflamingofavicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <title>DIGBY</title>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-JL3X2414G2"></script>
  <script>
    window.dataLayer=[];function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date()); gtag('config','G-JL3X2414G2');
  </script>

  <style>
    /* ‚Äî‚Äî‚Äî layout ‚Äî‚Äî‚Äî */
    body{font-family:'Inter',sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;margin:0;background:#f2f2f2;}
    .search-container{text-align:center;width:100%;}
    .search-box{padding:10px 20px;width:500px;max-width:90%;margin:0 auto;display:block;border:1px solid #ddd;border-radius:24px;font-size:16px;}

    .buttons-container{display:flex;justify-content:center;margin-top:20px;}
    .search-btn{padding:10px 20px;font-size:16px;border:none;border-radius:24px;background:#4285f4;color:#fff;cursor:pointer;margin:0 10px;}

    .logo{max-width:300px;margin:0 auto;display:block;transition:transform .5s linear;}
    .logo.spin{animation:spin 2s linear infinite;}
    @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}

    .response-wrapper{position:relative;display:inline-block;}
    .response{margin-top:20px;font-size:16px;color:#333;text-align:left;white-space:pre-wrap;max-height:200px;overflow-y:auto;
              border:1px solid #ddd;border-radius:10px;padding:14px 18px;background:#fff;box-shadow:0 0 10px rgba(0,0,0,.1);
              width:500px;max-width:90%;margin:20px auto;}
    .response strong{font-weight:700;}
    .copy-btn{position:absolute;top:6px;right:6px;background:transparent;border:none;cursor:pointer;font-size:18px;opacity:.6;}
    .copy-btn:hover{opacity:1;}

    .fluff{font-size:14px;color:#666;margin-top:6px;text-align:center;}
    .edit-note{font-size:12px;color:#666;text-align:center;margin-top:10px;}
    .warning{color:red;font-size:14px;margin-top:10px;}

    /* modal */
    .modal{display:none;position:fixed;z-index:2;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.4);
           justify-content:center;align-items:center;}
    .modal-content{background:#fff;padding:24px 32px;border-radius:16px;box-shadow:0 8px 20px rgba(0,0,0,.25);text-align:center;}

    /* style buttons */
    .style-btn{padding:12px 28px;margin:0 12px;border:none;border-radius:20px;cursor:pointer;font-size:16px;text-transform:lowercase;color:#fff;
               transition:background .15s,transform .15s,box-shadow .15s;}

    .lish-btn{background:#2c3e50;}
    .lish-btn:hover{background:#16202a;}
    .lish-btn:active{transform:scale(.75) translateY(2px);box-shadow:0 0 0 2px #000 inset;}

    .gonzo-btn{background:#e95800;}
    .gonzo-btn:hover{background:#ba4600;}
    @keyframes wiggle{0%,100%{transform:rotate(0)}20%{transform:rotate(6deg)}50%{transform:rotate(-6deg)}80%{transform:rotate(4deg)}}
    @keyframes flash{0%,100%{filter:none}50%{filter:brightness(1.4) saturate(1.8);}}
    .gonzo-btn:active{animation:wiggle .4s ease-in-out,flash .4s linear;}
  </style>
</head>
<body>
  <div class="search-container">
    <img src="digbyflamingo.png" alt="DIGBY Logo" class="logo" id="logo">
    <textarea class="search-box" rows="7" placeholder="Paste your copy here, then select an enhancement..."></textarea>
    <div class="warning" id="warning" style="display:none;">Please enter no more than 20&nbsp;000 words.</div>

    <div class="buttons-container">
      <button class="search-btn" onclick="prepDigby()">DIGBY it</button>
      <button class="search-btn" onclick="submitQuery('copywriting')">frame it</button>
    </div>

    <div class="response-wrapper">
      <button class="copy-btn" id="copyBtn" title="Copy to clipboard">üì¶</button>
      <div class="response" id="response"></div>
      <div class="fluff" id="fluffMeter"></div>
    </div>

    <div class="edit-note">Always edit what Digby gives you. Writing is rewriting. üòâ</div>
  </div>

  <!-- style picker -->
  <div id="styleModal" class="modal">
    <div class="modal-content">
      <p style="margin:0 0 18px;font-weight:600;">pick a style</p>
      <button class="style-btn lish-btn"  onclick="runStyle('lish',this)">ü™í lish</button>
      <button class="style-btn gonzo-btn" onclick="runStyle('gonzo',this)">ü¶á gonzo</button>
    </div>
  </div>

  <!-- (welcome & email modals unchanged) -->

<script>
  function countWords(s){return s.trim().split(/\\s+/).length;}
  function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

  let lastQuery='';
  const copyBtn=document.getElementById('copyBtn'); copyBtn.style.display='none';

  function prepDigby(){
    lastQuery=document.querySelector('.search-box').value.trim();
    if(!lastQuery){alert('Paste some text first.');return;}
    if(countWords(lastQuery)>20000){
      document.getElementById('warning').style.display='block';return;
    }
    document.getElementById('warning').style.display='none';
    document.getElementById('styleModal').style.display='flex';
  }

  // delay 250 ms so :active animation is visible
  async function runStyle(flag, btn){
    btn.blur();                                   // mobile browsers: release focus
    setTimeout(()=>{ document.getElementById('styleModal').style.display='none'; }, 250);
    await submitQuery('digby',flag);
  }

  async function submitQuery(mode,style='hybrid'){
    const logo=document.getElementById('logo');
    const resp=document.getElementById('response');
    const fluff=document.getElementById('fluffMeter');
    const textBody = mode==='digby' ? lastQuery : document.querySelector('.search-box').value.trim();
    if(!textBody){alert('Paste some text first.');return;}

    try{
      logo.classList.add('spin');
      const r=await fetch('https://pirb9ilp3e.execute-api.us-east-1.amazonaws.com/dev/analyze',{
        method:'POST',headers:{'Content-Type':'application/json'},
        body:JSON.stringify({text:textBody,mode,style})
      });
      if(r.status===403){showModal();resp.innerText='Please provide your email to continue.';return;}
      if(!r.ok) throw new Error('Network error');
      const data=await r.json();

      resp.innerHTML='<strong>Digby wrote it like this:</strong><br><br>'+esc(data.transformedText).replace(/\\n/g,'<br>');
      fluff.innerText=(typeof data.fluff!=='undefined')?`üí≠ Fluff cut: ${data.fluff}%`:'';

      copyBtn.style.display='block'; copyBtn.innerText='üì¶';
      copyBtn.onclick=async()=>{
        try{await navigator.clipboard.writeText(data.transformedText);
            copyBtn.innerText='‚úÖ'; setTimeout(()=>copyBtn.innerText='üì¶',1500);}
        catch{copyBtn.innerText='‚ùå';}
      };

    }catch(e){resp.innerText=`Error: ${e.message}`;}
    finally{logo.classList.remove('spin');}
  }

  /* existing modal helpers (welcome/email) unchanged */
</script>
</body>
</html>
